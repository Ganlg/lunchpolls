{% extends 'base.html' %}

{% block content %}
<div class="container">
    {% include 'nav_buttons.html' %}
    <br><br>
    
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Title</th>
                <th>Time</th>
                <th>Comment</th>
                <th>Created by</th>
                <th>Status</th>
                <th>Votes</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{post}}</td>
                <td>{{post.time}}</td>
                <td>{{post.comment}}</td>
                <td>{{post.author}}</td>
                <td>{{post.status}}</td>
                <td>{{post.votes}}</td>

            </tr>
        </tbody>
    </table>
    {% if not voted %}
    <form method='post' action=".">
        {% csrf_token %}
        <div class="form-group">
        <h3>First Vote</h3>
        <select class="form-control" name="first">
            {% for rest in restaurants %}
                <option value={{rest.id}}>
                    {% if rest.comment %}
                    {% with rest.restaurant|add:" ("|add:rest.comment|add:")" as varname %}
                    {{varname }}
                    {% endwith %}
                    {%else%}
                    {{ rest }}
                    {%endif%}
                </option>
            {% endfor %}
        </select>
        
        <h3>Second Vote</h3>
        <select class="form-control" name="second">
            {% for rest in restaurants %}
                <option value={{rest.id}}>
                    {% if rest.comment %}
                    {% with rest.restaurant|add:" ("|add:rest.comment|add:")" as varname %}
                    {{varname }}
                    {% endwith %}
                    {%else%}
                    {{ rest }}
                    {%endif%}
                </option>
            {% endfor %}
        </select>
        
        <h3>Third Vote</h3>
        <select class="form-control" name="third">
            {% for rest in restaurants %}
                <option value={{rest.id}}>
                    {% if rest.comment %}
                    {% with rest.restaurant|add:" ("|add:rest.comment|add:")" as varname %}
                    {{varname }}
                    {% endwith %}
                    {%else%}
                    {{ rest }}
                    {%endif%}
                </option>
            {% endfor %}
        </select>
            
        <h3>Least Favorite</h3>
        <select class="form-control" name="exlcude">
            {% for rest in restaurants %}
                <option value={{rest.id}}>
                    {% if rest.comment %}
                    {% with rest.restaurant|add:" ("|add:rest.comment|add:")" as varname %}
                    {{varname }}
                    {% endwith %}
                    {%else%}
                    {{ rest }}
                    {%endif%}
                </option>
            {% endfor %}
        </select>
        </div>
        <button type="submit" class='btn btn-success'>Submit</button>
        <a href="{% url 'lunch:index' %}" class='btn btn-default'>Cancel</a>
    </form>
    {% else %}
        <h3>Current Vote Result</h3>
        <table class="table table-striped table-condens">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Restaurant</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>{{top1}}</td>
                    <td>{{score1}}</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>{{top2}}</td>
                    <td>{{score2}}</td>
                </tr>
            </tbody>
    
        </table>
        <table class="table table-striped table-condense">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>First Choice</th>
                    <th>Second Choice</th>
                    <th>Third Choice</th>
                </tr>
            </thead>
            <tbody>
            {% for vote in vote_detail %}
                {% if forloop.counter|add:-1|divisibleby:3 %}
                    <tr><td>{{vote.user}}</td><td>{% if vote.restaurant.comment %}
                        {% with vote.restaurant.restaurant|add:" ("|add:vote.restaurant.comment|add:")" as varname%}
                        {{ varname }}
                        {% endwith %}
                    {%else%}
                    {{ vote.restaurant }}
                    {%endif%}</td>
                {% else %}
                        <td>{% if vote.restaurant.comment %}
                    {% with vote.restaurant.restaurant|add:" ("|add:vote.restaurant.comment|add:")" as varname%}
                        {{varname }}
                        {% endwith %}
                    {%else%}
                    {{ vote.restaurant }}{%endif%}</td>
                {% endif %}
                        
                {% if forloop.counter|divisibleby:3 %}
                </tr>
                {% endif %}
            {% endfor%}
            </tbody>
        </table>
    {% endif %}
</div>
{% endblock %}